<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Quiz System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: #fafafa;
            color: #1a1a1a;
            line-height: 1.5;
            min-height: 100vh;
            padding: 0;
        }
        
        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 40px 24px;
        }
        
        .section {
            display: none;
        }
        
        .active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .header {
            margin-bottom: 32px;
            text-align: center;
        }
        
        .title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111827;
        }
        
        .description {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
        }
        
        input[type="text"], input[type="email"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
            background-color: white;
        }
        
        input[type="text"]:focus, input[type="email"]:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
        }
        
        .btn:hover {
            background-color: #1d4ed8;
        }
        
        .btn:active {
            background-color: #1e40af;
        }
        
        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            padding: 12px 16px;
            background-color: #f3f4f6;
            border-radius: 6px;
        }
        
        .timer {
            font-weight: 600;
            color: #dc2626;
        }
        
        .question-container {
            margin-bottom: 32px;
        }
        
        .question-number {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .question-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #111827;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 16px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
        }
        
        .option:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }
        
        .option.selected {
            background-color: #eff6ff;
            border-color: #2563eb;
        }
        
        .warning {
            background-color: #fef2f2;
            color: #dc2626;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        .warning.active {
            display: flex;
            animation: shake 0.5s;
        }
        
        .security-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background-color: #fef3c7;
            border-radius: 6px;
            margin-bottom: 24px;
            font-size: 14px;
        }
        
        .progress-container {
            margin-bottom: 24px;
        }
        
        .progress-bar {
            height: 4px;
            background-color: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #2563eb;
            width: 0%;
            transition: width 0.3s;
        }
        
        .results-container {
            text-align: center;
        }
        
        .score {
            font-size: 48px;
            font-weight: 700;
            color: #2563eb;
            margin: 24px 0;
        }
        
        .summary {
            text-align: left;
            background-color: #f9fafb;
            padding: 24px;
            border-radius: 8px;
            margin-top: 24px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #6b7280;
        }
        
        .summary-value {
            font-weight: 500;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .instructions {
            background-color: #eff6ff;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 24px;
        }
        
        .instructions-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1e40af;
        }
        
        .instructions-list {
            padding-left: 20px;
        }
        
        .instructions-list li {
            margin-bottom: 4px;
        }
        
        .icon {
            width: 20px;
            height: 20px;
        }
        
        .student-info {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        
        .loading.active {
            display: block;
        }
        
        .error-message {
            background-color: #fef2f2;
            color: #dc2626;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            text-align: center;
            display: none;
        }
        
        .error-message.active {
            display: block;
        }
        
        .success-message {
            background-color: #f0fdf4;
            color: #166534;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            text-align: center;
            display: none;
        }
        
        .success-message.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Section -->
        <div id="welcome-section" class="section active">
            <div class="header">
                <h1 class="title">Secure Quiz System</h1>
                <p class="description">Please enter your details to begin the assessment</p>
            </div>
            
            <div class="instructions">
                <div class="instructions-title">Important Instructions</div>
                <ul class="instructions-list">
                    <li>You have 60 seconds to answer each question</li>
                    <li>Switching tabs will result in a 2-point penalty</li>
                    <li>Copying text or taking screenshots is prohibited</li>
                    <li>More than 6 cheating attempts will terminate the quiz</li>
                    <li>Each student can attempt the quiz only once</li>
                </ul>
            </div>
            
            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>
            
            <div class="form-group">
                <label for="student-name">Full Name *</label>
                <input type="text" id="student-name" placeholder="Enter your full name" required>
            </div>
            
            <div class="form-group">
                <label for="student-email">Email Address *</label>
                <input type="email" id="student-email" placeholder="Enter your email address" required>
            </div>
            
            <div class="form-group">
                <label for="student-id">Student ID *</label>
                <input type="text" id="student-id" placeholder="Enter your student ID" required>
            </div>
            
            <button id="start-quiz" class="btn">Start Quiz</button>
            
            <div class="loading" id="loading-welcome">
                <p>Verifying your access...</p>
            </div>
        </div>
        
        <!-- Quiz Section -->
        <div id="quiz-section" class="section">
            <div class="student-info" id="student-display"></div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
            </div>
            
            <div class="timer-container">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>Time remaining: <span class="timer" id="timer">60s</span></div>
            </div>
            
            <div class="warning" id="warning">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <div>Warning! You have switched tabs. 2 points will be deducted from your score.</div>
            </div>
            
            <div class="question-container">
                <div class="question-number" id="question-number">Question 1 of 5</div>
                <div class="question-text" id="question-text">What is the capital of France?</div>
                
                <div class="options" id="options">
                    <!-- Options will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="security-info">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
                <div>Security Status: <span id="cheating-count">0</span> cheating attempts detected</div>
            </div>
            
            <button id="next-question" class="btn">Next Question</button>
            
            <div class="loading" id="loading-quiz">
                <p>Saving your progress...</p>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="section">
            <div class="header">
                <h1 class="title">Quiz Completed</h1>
                <p class="description">Thank you for completing the assessment</p>
            </div>
            
            <div class="results-container">
                <div class="score" id="final-score">0/50</div>
                
                <div class="summary">
                    <div class="summary-item">
                        <span class="summary-label">Student Name:</span>
                        <span class="summary-value" id="summary-name">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Email:</span>
                        <span class="summary-value" id="summary-email">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Student ID:</span>
                        <span class="summary-value" id="summary-id">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Total Questions:</span>
                        <span class="summary-value" id="summary-total">5</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Correct Answers:</span>
                        <span class="summary-value" id="summary-correct">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Cheating Attempts:</span>
                        <span class="summary-value" id="summary-cheating">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Points Deducted:</span>
                        <span class="summary-value" id="summary-deducted">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Final Score:</span>
                        <span class="summary-value" id="summary-final">0</span>
                    </div>
                </div>
            </div>
            
            <div class="loading" id="loading-results">
                <p>Saving your results...</p>
            </div>
        </div>
    </div>

    <script>
        // ðŸ”§ CONFIGURATION - REPLACE WITH YOUR GOOGLE APPS SCRIPT URL
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx3vd2wAcmlnnZP6HsZel2qSART2BU912SGswaXZOjcJMXr96-xJjcFwKOxid1iyYC0/exec';
        
        // Quiz data
        const quizData = [
            {
                question: "What is the capital of France?",
                options: ["London", "Berlin", "Paris", "Madrid"],
                correct: 2
            },
            {
                question: "Which planet is known as the Red Planet?",
                options: ["Venus", "Mars", "Jupiter", "Saturn"],
                correct: 1
            },
            {
                question: "What is the largest mammal in the world?",
                options: ["Elephant", "Blue Whale", "Giraffe", "Polar Bear"],
                correct: 1
            },
            {
                question: "Who wrote 'Romeo and Juliet'?",
                options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"],
                correct: 1
            },
            {
                question: "What is the chemical symbol for gold?",
                options: ["Go", "Gd", "Au", "Ag"],
                correct: 2
            }
        ];

        // DOM elements
        const welcomeSection = document.getElementById('welcome-section');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const studentNameInput = document.getElementById('student-name');
        const studentEmailInput = document.getElementById('student-email');
        const studentIdInput = document.getElementById('student-id');
        const studentDisplay = document.getElementById('student-display');
        const startQuizBtn = document.getElementById('start-quiz');
        const nextQuestionBtn = document.getElementById('next-question');
        const timerElement = document.getElementById('timer');
        const warningElement = document.getElementById('warning');
        const questionNumberElement = document.getElementById('question-number');
        const questionTextElement = document.getElementById('question-text');
        const optionsElement = document.getElementById('options');
        const cheatingCountElement = document.getElementById('cheating-count');
        const progressElement = document.getElementById('progress');
        const finalScoreElement = document.getElementById('final-score');
        const summaryNameElement = document.getElementById('summary-name');
        const summaryEmailElement = document.getElementById('summary-email');
        const summaryIdElement = document.getElementById('summary-id');
        const summaryTotalElement = document.getElementById('summary-total');
        const summaryCorrectElement = document.getElementById('summary-correct');
        const summaryCheatingElement = document.getElementById('summary-cheating');
        const summaryDeductedElement = document.getElementById('summary-deducted');
        const summaryFinalElement = document.getElementById('summary-final');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');
        const loadingWelcome = document.getElementById('loading-welcome');
        const loadingQuiz = document.getElementById('loading-quiz');
        const loadingResults = document.getElementById('loading-results');

        // Quiz state
        let currentQuestion = 0;
        let score = 0;
        let timeLeft = 60;
        let timer;
        let cheatingAttempts = 0;
        let studentName = "";
        let studentEmail = "";
        let studentId = "";
        let selectedOption = null;
        let tabSwitched = false;
        let answers = [];
        let sessionId = '';
        let hasAttempted = false;

        // Event listeners
        startQuizBtn.addEventListener('click', startQuiz);
        nextQuestionBtn.addEventListener('click', nextQuestion);

        // Anti-cheating measures
        document.addEventListener('visibilitychange', handleVisibilityChange);
        document.addEventListener('copy', preventCopy);
        document.addEventListener('cut', preventCopy);
        document.addEventListener('paste', preventCopy);
        document.addEventListener('contextmenu', preventRightClick);
        document.addEventListener('keydown', preventScreenshot);

        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Check if student has already attempted
        async function checkStudentAttempt() {
            const studentId = studentIdInput.value.trim();
            const email = studentEmailInput.value.trim();
            
            if (!studentId || !email) return false;
            
            try {
                console.log('Checking student attempt...');
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'checkAttempt',
                        studentId: studentId,
                        studentEmail: email
                    })
                });
                
                const result = await response.json();
                console.log('Check attempt result:', result);
                return result.hasAttempted || false;
            } catch (error) {
                console.error('Error checking student attempt:', error);
                showError('Network error. Please check your connection and try again.');
                return false;
            }
        }

        // Save data to Google Sheets
        async function saveToSheets(data) {
            try {
                console.log('Saving to sheets:', data);
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('Save result:', result);
                return result.success;
            } catch (error) {
                console.error('Error saving to sheets:', error);
                showError('Failed to save data. Please try again.');
                return false;
            }
        }

        // Functions
        async function startQuiz() {
            studentName = studentNameInput.value.trim();
            studentEmail = studentEmailInput.value.trim();
            studentId = studentIdInput.value.trim();
            
            if (!studentName || !studentEmail || !studentId) {
                showError("Please fill in all fields to start the quiz.");
                return;
            }
            
            // Validate email format
            if (!isValidEmail(studentEmail)) {
                showError("Please enter a valid email address.");
                return;
            }
            
            // Show loading
            startQuizBtn.disabled = true;
            loadingWelcome.classList.add('active');
            
            // Check if student has already attempted
            hasAttempted = await checkStudentAttempt();
            
            if (hasAttempted) {
                showError("You have already attempted this quiz. Each student can only attempt once.");
                loadingWelcome.classList.remove('active');
                startQuizBtn.disabled = false;
                return;
            }
            
            // Generate session ID
            sessionId = generateSessionId();
            
            // Update student display
            studentDisplay.textContent = `${studentName} (${studentId})`;
            
            // Save initial session data
            const sessionData = {
                action: 'startSession',
                sessionId: sessionId,
                studentName: studentName,
                studentEmail: studentEmail,
                studentId: studentId,
                startTime: new Date().toISOString()
            };
            
            const sessionSaved = await saveToSheets(sessionData);
            
            if (!sessionSaved) {
                showError("Failed to start quiz session. Please try again.");
                loadingWelcome.classList.remove('active');
                startQuizBtn.disabled = false;
                return;
            }
            
            // Show quiz section
            welcomeSection.classList.remove('active');
            quizSection.classList.add('active');
            
            // Initialize quiz
            currentQuestion = 0;
            score = 0;
            cheatingAttempts = 0;
            answers = [];
            updateCheatingCount();
            loadQuestion();
            startTimer();
            
            loadingWelcome.classList.remove('active');
            showSuccess("Quiz started successfully! Good luck!");
        }

        function loadQuestion() {
            // Reset UI
            selectedOption = null;
            tabSwitched = false;
            optionsElement.innerHTML = '';
            warningElement.classList.remove('active');
            
            // Update progress
            const progress = ((currentQuestion) / quizData.length) * 100;
            progressElement.style.width = `${progress}%`;
            
            // Load question data
            const question = quizData[currentQuestion];
            questionNumberElement.textContent = `Question ${currentQuestion + 1} of ${quizData.length}`;
            questionTextElement.textContent = question.question;
            
            // Create options
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionElement.addEventListener('click', selectOption);
                optionsElement.appendChild(optionElement);
            });
            
            // Reset timer
            resetTimer();
        }

        function selectOption(e) {
            // Deselect previous option
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            
            // Select new option
            e.target.classList.add('selected');
            selectedOption = parseInt(e.target.dataset.index);
        }

        async function nextQuestion() {
            if (selectedOption === null) {
                alert("Please select an answer before proceeding.");
                return;
            }
            
            // Show loading
            nextQuestionBtn.disabled = true;
            loadingQuiz.classList.add('active');
            
            // Check if answer is correct
            const question = quizData[currentQuestion];
            const isCorrect = selectedOption === question.correct;
            
            // Record answer
            const answerData = {
                question: question.question,
                selected: selectedOption,
                correct: question.correct,
                isCorrect: isCorrect,
                timeSpent: 60 - timeLeft,
                tabSwitched: tabSwitched
            };
            
            answers.push(answerData);
            
            // Update score
            if (isCorrect) {
                score += 10;
            }
            
            // Deduct points for tab switching
            if (tabSwitched) {
                score = Math.max(0, score - 2);
            }
            
            // Save answer to Google Sheets
            const saveData = {
                action: 'saveAnswer',
                sessionId: sessionId,
                questionNumber: currentQuestion + 1,
                answerData: answerData,
                currentScore: score,
                cheatingAttempts: cheatingAttempts,
                timestamp: new Date().toISOString()
            };
            
            await saveToSheets(saveData);
            
            // Move to next question or finish quiz
            currentQuestion++;
            
            if (currentQuestion < quizData.length) {
                loadQuestion();
                nextQuestionBtn.disabled = false;
                loadingQuiz.classList.remove('active');
            } else {
                await finishQuiz();
            }
        }

        async function finishQuiz() {
            // Stop timer
            clearInterval(timer);
            
            // Calculate final score
            const pointsDeducted = cheatingAttempts * 2;
            const finalScore = Math.max(0, score - pointsDeducted);
            
            // Save final results
            const finalData = {
                action: 'saveResults',
                sessionId: sessionId,
                studentName: studentName,
                studentEmail: studentEmail,
                studentId: studentId,
                finalScore: finalScore,
                totalQuestions: quizData.length,
                correctAnswers: answers.filter(a => a.isCorrect).length,
                cheatingAttempts: cheatingAttempts,
                pointsDeducted: pointsDeducted,
                answers: answers,
                endTime: new Date().toISOString()
            };
            
            loadingResults.classList.add('active');
            const saveSuccess = await saveToSheets(finalData);
            loadingResults.classList.remove('active');
            
            if (saveSuccess) {
                // Update results
                finalScoreElement.textContent = `${finalScore}/${quizData.length * 10}`;
                summaryNameElement.textContent = studentName;
                summaryEmailElement.textContent = studentEmail;
                summaryIdElement.textContent = studentId;
                summaryTotalElement.textContent = quizData.length;
                summaryCorrectElement.textContent = answers.filter(a => a.isCorrect).length;
                summaryCheatingElement.textContent = cheatingAttempts;
                summaryDeductedElement.textContent = pointsDeducted;
                summaryFinalElement.textContent = finalScore;
                
                // Show results section
                quizSection.classList.remove('active');
                resultsSection.classList.add('active');
                
                showSuccess("Your results have been saved successfully!");
            } else {
                showError("There was an error saving your results. Please contact your instructor.");
            }
            
            nextQuestionBtn.disabled = false;
        }

        function startTimer() {
            resetTimer();
            timer = setInterval(updateTimer, 1000);
        }

        function resetTimer() {
            timeLeft = 60;
            updateTimerDisplay();
        }

        function updateTimer() {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                // Auto-submit if time runs out
                if (selectedOption === null) {
                    selectedOption = -1; // No answer selected
                }
                nextQuestion();
            }
        }

        function updateTimerDisplay() {
            timerElement.textContent = `${timeLeft}s`;
            
            // Change color when time is running out
            if (timeLeft <= 10) {
                timerElement.style.color = '#dc2626';
            }
        }

        function handleVisibilityChange() {
            if (document.hidden) {
                // User switched tabs
                cheatingAttempts++;
                tabSwitched = true;
                updateCheatingCount();
                
                // Show warning
                warningElement.classList.add('active');
                
                // Save cheating attempt
                saveToSheets({
                    action: 'cheatingAttempt',
                    sessionId: sessionId,
                    attemptNumber: cheatingAttempts,
                    timestamp: new Date().toISOString(),
                    type: 'tabSwitch'
                });
                
                // Terminate quiz if too many cheating attempts
                if (cheatingAttempts >= 6) {
                    alert("Quiz terminated due to excessive cheating attempts.");
                    finishQuiz();
                }
            }
        }

        function updateCheatingCount() {
            cheatingCountElement.textContent = cheatingAttempts;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('active');
            setTimeout(() => {
                errorMessage.classList.remove('active');
            }, 5000);
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.classList.add('active');
            setTimeout(() => {
                successMessage.classList.remove('active');
            }, 3000);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Anti-cheating functions
        function preventCopy(e) {
            e.preventDefault();
            alert("Copying text is not allowed during the quiz.");
            cheatingAttempts++;
            updateCheatingCount();
            saveToSheets({
                action: 'cheatingAttempt',
                sessionId: sessionId,
                attemptNumber: cheatingAttempts,
                timestamp: new Date().toISOString(),
                type: 'copyAttempt'
            });
            return false;
        }

        function preventRightClick(e) {
            e.preventDefault();
            alert("Right-click is disabled during the quiz.");
            cheatingAttempts++;
            updateCheatingCount();
            saveToSheets({
                action: 'cheatingAttempt',
                sessionId: sessionId,
                attemptNumber: cheatingAttempts,
                timestamp: new Date().toISOString(),
                type: 'rightClickAttempt'
            });
            return false;
        }

        function preventScreenshot(e) {
            // Prevent common screenshot shortcuts
            if ((e.ctrlKey && e.key === 'PrintScreen') || 
                (e.key === 'PrintScreen') || 
                (e.metaKey && e.shiftKey && e.key === '3') || 
                (e.metaKey && e.shiftKey && e.key === '4')) {
                e.preventDefault();
                alert("Screenshots are not allowed during the quiz.");
                cheatingAttempts++;
                updateCheatingCount();
                saveToSheets({
                    action: 'cheatingAttempt',
                    sessionId: sessionId,
                    attemptNumber: cheatingAttempts,
                    timestamp: new Date().toISOString(),
                    type: 'screenshotAttempt'
                });
                return false;
            }
        }

        // Test connection on load
        window.addEventListener('load', function() {
            console.log('Quiz system loaded');
            console.log('Google Apps Script URL:', GOOGLE_APPS_SCRIPT_URL);
        });
    </script>
</body>
</html>